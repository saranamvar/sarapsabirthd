<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Happy Birthday Sana</title>
<style>
  body { margin:0; overflow:hidden; background:#000; font-family:sans-serif; }
  canvas { display:block; }
  #messageBox {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    background: rgba(0,0,0,0.7);
    padding:20px;
    border-radius:10px;
    display:none;
    max-width: 90%;
    text-align: center;
    font-size: 1.2em;
  }
</style>
</head>
<body>
<div id="messageBox"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,5,12);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lights
let ambient = new THREE.AmbientLight(0xffffff,0.6);
scene.add(ambient);
let spot = new THREE.SpotLight(0xffffff,1);
spot.position.set(15,30,20);
spot.castShadow = true;
scene.add(spot);

// --- Foam (Ú©Ù Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ) ---
let foamParticles = [];
for(let i=0;i<250;i++){
  let geo = new THREE.SphereGeometry(0.05 + Math.random()*0.05,8,8);
  let mat = new THREE.MeshBasicMaterial({color:0xffffff, transparent:true, opacity:0.9});
  let p = new THREE.Mesh(geo,mat);
  p.position.set((Math.random()-0.5)*10,-2 + Math.random()*2,(Math.random()-0.5)*5);
  p.velocity = new THREE.Vector3((Math.random()-0.5)*0.1,Math.random()*0.1,0);
  scene.add(p);
  foamParticles.push(p);
}

// --- Text using Plane ---
let textCanvas = document.createElement('canvas');
textCanvas.width = 1024;
textCanvas.height = 256;
let ctx = textCanvas.getContext('2d');
ctx.fillStyle = "cyan";
ctx.font = "60px sans-serif";
ctx.textAlign = "center";
ctx.fillText("Happy Birthday Sana", textCanvas.width/2, 80);
ctx.fillText("ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú© Ø³Ù†Ø§", textCanvas.width/2, 180);
let textTexture = new THREE.CanvasTexture(textCanvas);
let textMaterial = new THREE.MeshBasicMaterial({map:textTexture, transparent:true});
let textMesh = new THREE.Mesh(new THREE.PlaneGeometry(8,2), textMaterial);
textMesh.position.set(0,3,0);
textMesh.visible=false;
scene.add(textMesh);

// --- Cake (Ú†Ù†Ø¯ Ù„Ø§ÛŒÙ‡) ---
let cakeGroup = new THREE.Group();
let base = new THREE.Mesh(new THREE.CylinderGeometry(2,2,1,32), new THREE.MeshPhongMaterial({color:0xffc0cb}));
cakeGroup.add(base);
let layer = new THREE.Mesh(new THREE.CylinderGeometry(1.5,1.5,0.7,32), new THREE.MeshPhongMaterial({color:0xff69b4}));
layer.position.y=0.85;
cakeGroup.add(layer);
cakeGroup.position.y=-5;
scene.add(cakeGroup);

// --- Candles with glow ---
let candleMat = new THREE.MeshPhongMaterial({color:0xffff00});
let flames = [];
for(let i=-1;i<=1;i++){
  let candle = new THREE.Mesh(new THREE.CylinderGeometry(0.1,0.1,0.7,16), candleMat);
  candle.position.set(i*0.8,1.4,0);
  cakeGroup.add(candle);
  let flame = new THREE.Mesh(new THREE.SphereGeometry(0.15,16,16), new THREE.MeshBasicMaterial({color:0xff4500}));
  flame.position.set(i*0.8,1.8,0);
  flame.name="flame";
  flame.visible=false;
  flames.push(flame);
  cakeGroup.add(flame);
}

// --- Fireworks ---
let particles=[];
function createFirework(){
  for(let i=0;i<100;i++){
    let geom=new THREE.SphereGeometry(0.05,8,8);
    let mat=new THREE.MeshBasicMaterial({color:Math.random()*0xffffff});
    let p=new THREE.Mesh(geom,mat);
    p.position.set(0,2,0);
    p.velocity=new THREE.Vector3((Math.random()-0.5)*0.5,Math.random()*0.5,(Math.random()-0.5)*0.5);
    scene.add(p);
    particles.push(p);
  }
}

// --- Envelope ---
let envelope = new THREE.Mesh(new THREE.BoxGeometry(2.5,1.5,0.1), new THREE.MeshPhongMaterial({color:0xffffff}));
envelope.position.set(0,-5,0);
envelope.visible=false;
scene.add(envelope);

let msgBox=document.getElementById("messageBox");
envelope.callback=function(){
  msgBox.innerHTML = `Ø³Ù†Ø§ Ø¬ÙˆÙ†Ù… ØªÙˆÙ„Ø¯Øª Ù…Ø¨Ø§Ø±Ú©ğŸ’–ğŸ‰<br><br>
ÙˆØ§Ù‚Ø¹Ø§ Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ Ø¨Ø§ Ù‡Ù…Ù‡ Ù‚Ù‡Ø± Ùˆ Ø¯Ø¹ÙˆØ§Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø§Ø´ØªÛŒÙ…ØŒ Ù‡Ù†ÙˆØ² Ø¯ÙˆØ³ØªÛŒÙ… Ùˆ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… Ú©Ù†Ø§Ø± Ù‡Ù… Ø¨Ø®Ù†Ø¯ÛŒÙ… Ùˆ Ø®ÙˆØ´ Ø¨Ú¯Ø°Ø±ÙˆÙ†ÛŒÙ….<br>
Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ù… Ø±ÙˆØ²Øª Ù¾Ø± Ø§Ø² Ù„Ø­Ø¸Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø´Ù†Ú¯ Ø¨Ø§Ø´Ù‡ Ùˆ Ø³Ø§Ù„ Ù¾ÛŒØ´â€ŒØ±Ùˆ Ø¨Ø±Ø§Øª Ù¾Ø± Ø§Ø² Ø§ØªÙØ§Ù‚Ø§ÛŒ Ø®ÙˆØ¨ØŒ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ Ùˆ Ø¯ÙˆØ³Øªâ€ŒØ¯Ø§Ø´ØªÙ†ÛŒ Ø¨Ø§Ø´Ù‡.<br>
Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø±Ø§Øª Ø¨Ù‡ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ Ø±Ùˆ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ùˆ Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ù… Ù‡Ø± Ø±ÙˆØ²Øª ÛŒÙ‡ Ú©Ù…ÛŒ Ø¨Ù‡ØªØ± Ø§Ø² Ø¯ÛŒØ±ÙˆØ² Ø¨Ø§Ø´Ù‡ ğŸŒ¸âœ¨<br><br>
<b>Ø§Ø² Ø·Ø±Ù Ù‡ÛŒÙˆÙ†Ú¯ Ø³Ø§Ø±Ø§Øª Ø¨Ù‡ Ø³Ù†Ø§ Ú©ÙˆÚ†ÙˆÙ„Ùˆ</b>`;
  msgBox.style.display='block';
}

// --- Animation ---
let clock = new THREE.Clock();
let step = 0;
function animate(){
  requestAnimationFrame(animate);
  let t = clock.getElapsedTime();

  // Foam movement
  foamParticles.forEach(p=>{
    p.position.add(p.velocity);
    if(p.position.y>5)p.position.y=-2;
  });

  // Show text
  if(step===0 && t>1){
    textMesh.visible=true;
    step=1;
  }

  // Cake rises
  if(step===1 && t>3){
    cakeGroup.position.y = -1.2;
    step=2;
  }

  // Light candles
  if(step===2 && t>4){
    flames.forEach(f=>f.visible=true);
    step=3;
  }

  // Blow candles after 7s
  if(step===3 && t>11){
    flames.forEach(f=>f.visible=false);
    step=4;
  }

  // Fireworks
  if(step===4 && t>12){
    createFirework();
    step=5;
  }

  if(step>=5){
    particles.forEach(p=>{
      p.position.add(p.velocity);
      if(p.material.opacity>0)p.material.opacity-=0.01;
    });
  }

  // Show envelope
  if(step>=5 && t>14){
    envelope.visible=true;
    envelope.position.y=0;
  }

  renderer.render(scene,camera);
}
animate();

// Click envelope
window.addEventListener('click',e=>{
  let mouse=new THREE.Vector2(
    (e.clientX/window.innerWidth)*2-1,
    -(e.clientY/window.innerHeight)*2+1
  );
  let ray=new THREE.Raycaster();
  ray.setFromCamera(mouse,camera);
  let hits=ray.intersectObjects([envelope]);
  if(hits.length>0){
    envelope.callback();
  }
});

// Resize
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
